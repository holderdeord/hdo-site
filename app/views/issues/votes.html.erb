<div class="page-header votes-header">
  <h1>
    <div class="lead">
      <%= Vote.model_name.human(count: 2).capitalize %> <%= Vote.human_attribute_name(:about) %> <%= t 'app.lang.infinitive_particle' %>
    </div>
    <%= link_to @issue, class:"votes-title" do %>
      <%= @issue.title %>
    <% end %>
  </h1>

<% if @issue.published? %>
  <aside class="muted">
    <%= Issue.human_attribute_name(:updated_at) %> <%= @issue.updated_at %>.
    <span class="issue-tags">
      Tagger:
      <% @issue.tags.each do |tag| %>
        <%= link_to tag.name, issues_path(anchor: "tag-#{tag.id}") %>
      <% end %>
    </span>
  </aside>
<% end %>

</div>

<div class="row-fluid">
  <% @issue_votes.each do |issue_vote| %>
    <div class="row-fluid">
      <div id="<%= issue_vote.anchor %>" class="span7">
        <h3><%= issue_vote.title %></h3>
        <p><%= raw(markdown(issue_vote.comment)) %></p>
      </div>

      <div class="span5 pull-right">
        <div class="facts-box">
          <h5>Faktaboks</h5>
          <small>
            <p><strong>Dato:</strong> <%= issue_vote.time_text %></p>
            <p><strong>Type:</strong> <%= issue_vote.proposition_type_text %></p>
            <p><strong>Vekt:</strong> <%= link_to issue_vote.weight_text, home_method_path(anchor: 'method-weights') %> (icon here)</p>
            <p><%= issue_vote.enacted_text.html_safe %></p>
            <p><%= issue_vote.matches_text.html_safe %> </p>
          </small>
        </div>
      </div>
    </div>

    <table class="table table-hover table-condensed">
      <thead>
        <th>For</th>
        <th>Mot</th>
        <th>Ikke tilstede</th>
      </thead>
      <% @all_parties.each do |party| %>
        <tr class="state-column">
          <% [:for, :against, :absent].each do |result_key| %>
            <td class="span4" data-party-slug="<%= party.slug %>-<%= issue_vote.title %>">
              <% if !issue_vote.vote_result_groups[result_key][party].empty? %>
                <%= image_tag party.logo, alt: party.name, width: '35', height: '35' %> <%= issue_vote.vote_result_groups[result_key][party].size %>
              <% end %>

              <div class="representatives-list hidden" data-party-slug="<%= party.slug %>-<%= issue_vote.title %>">
                <% issue_vote.vote_result_groups[result_key][party].each do |rep| %>
                    <p><%= link_to rep.name, rep %></p>
                <% end %>
              </div>
            </td>
          <% end %>
        </tr>
      <% end %>

    </table>
    <hr>
  <% end %>
</div>

<% content_for :document_ready do %>
  <script>
    $(document).ready(function () {
      var votes_column_handler = HDO.votes.create({
        columns: $('.state-column')
      });

      votes_column_handler.init();
    });
  </script>
<% end %>
